{"ast":null,"code":"import _asyncToGenerator from \"/Users/chineduetoh/Desktop/IONIC PROJECTS/Go_Rider/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"./payment.page.html?ngResource\";\nimport __NG_CLI_RESOURCE__1 from \"./payment.page.scss?ngResource\";\nimport { Component, ElementRef, ViewChild } from '@angular/core';\nimport { FormBuilder } from '@angular/forms';\nimport { AlertController, NavController } from '@ionic/angular';\nimport { HttpClient } from '@angular/common/http';\nimport { AvatarService } from 'src/app/services/avatar.service';\nimport { OverlayService } from 'src/app/services/overlay.service';\nlet PaymentPage = class PaymentPage {\n  constructor(prof, nav, http, alertCtrl, overlay, formBuilder) {\n    this.prof = prof;\n    this.nav = nav;\n    this.http = http;\n    this.alertCtrl = alertCtrl;\n    this.overlay = overlay;\n    this.formBuilder = formBuilder;\n    this.stripe = Stripe('pk_test_0t85o0Llo0MbBfC9imSzznam');\n    this.cash = 'cash';\n  }\n\n  ionViewDidEnter() {\n    this.skeletOns = [{}, {}, {}, {}, {}];\n    this.setupStripe();\n    this.prof.getCards().subscribe(d => {\n      console.log(d);\n      this.cards = d;\n      this.cards.forEach(element => {\n        console.log(element);\n\n        if (element.selected == true) {\n          this.selected = element;\n          this.selectedCard = element.name;\n          console.log(this.selectedCard);\n        }\n      });\n    });\n  }\n\n  chooseCard(event) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      console.log(event);\n\n      _this.overlay.showLoader('Please wait..');\n\n      yield _this.prof.updateCArd(_this.selected.name, _this.selected.number, _this.selected.type, _this.selected.id, false);\n      yield _this.prof.updateCArd(event.name, event.number, event.type, event.id, true);\n\n      _this.overlay.hideLoader();\n    })();\n  }\n\n  setupStripe() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      const appearance = {\n        theme: 'flat',\n        variables: {\n          colorPrimary: '#0570de',\n          colorBackground: '#ffffff',\n          colorText: '#30313d',\n          colorDanger: '#df1b41',\n          fontFamily: 'Ideal Sans, system-ui, sans-serif',\n          spacingUnit: '2px',\n          borderRadius: '4px' // See all possible variables below\n\n        }\n      };\n\n      let elements = _this2.stripe.elements();\n\n      var style = {\n        base: {\n          color: '#32325d',\n          lineHeight: '24px',\n          fontFamily: '\"Helvetica Neue\", Helvetica, sans-serif',\n          fontSmoothing: 'antialiased',\n          fontSize: '17px',\n          '::placeholder': {\n            color: '#aab7c4'\n          }\n        },\n        invalid: {\n          color: '#fa755a',\n          iconColor: '#3880ff'\n        }\n      };\n      _this2.card = elements.create('card', {\n        style: style\n      });\n\n      _this2.card.mount('#card-element');\n\n      _this2.card.addEventListener('change', event => {\n        var displayError = document.getElementById('card-errors');\n\n        if (event.error) {\n          displayError.textContent = event.error.message;\n        } else {\n          displayError.textContent = '';\n        }\n      });\n\n      var form = document.getElementById('payment-form');\n      form.addEventListener('submit', event => {\n        event.preventDefault();\n        console.log(event, _this2.card);\n        _this2.approve = true;\n\n        _this2.stripe.createSource(_this2.card).then( /*#__PURE__*/function () {\n          var _ref = _asyncToGenerator(function* (result) {\n            _this2.approve = false;\n\n            if (result.error) {\n              var errorElement = document.getElementById('card-errors');\n              errorElement.textContent = result.error.message;\n\n              _this2.overlay.showAlert('Payment Error', result.error.message);\n            } else {\n              console.log(result.source.id);\n              yield _this2.prof.updateCArd(_this2.selected.name, _this2.selected.number, _this2.selected.type, _this2.selected.id, false);\n              yield _this2.prof.createCard(result.source.card.last4, result.source.card.last4, result.source.card.brand, result.source.id);\n\n              _this2.card.removeEventListener('change', event => {});\n\n              form.removeEventListener('submit', event => {});\n              yield _this2.overlay.showToast('Successfully Added Card!');\n\n              _this2.setupStripe(); //  this.makePayment(result.id);\n\n            }\n          });\n\n          return function (_x) {\n            return _ref.apply(this, arguments);\n          };\n        }());\n      });\n    })();\n  }\n\n  showPayMentAlert(title, subtitle, canLeave) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      const alert = yield _this3.alertCtrl.create({\n        header: title,\n        subHeader: subtitle,\n        buttons: [{\n          text: 'Approve',\n          role: 'cancel',\n          handler: () => {\n            if (canLeave) {\n              _this3.nav.pop();\n            }\n          }\n        }],\n        backdropDismiss: false\n      });\n      alert.present();\n    })();\n  }\n\n  ngOnInit() {}\n\n};\n\nPaymentPage.ctorParameters = () => [{\n  type: AvatarService\n}, {\n  type: NavController\n}, {\n  type: HttpClient\n}, {\n  type: AlertController\n}, {\n  type: OverlayService\n}, {\n  type: FormBuilder\n}];\n\nPaymentPage.propDecorators = {\n  stripeButton: [{\n    type: ViewChild,\n    args: ['paymentform', {\n      read: ElementRef\n    }]\n  }]\n};\nPaymentPage = __decorate([Component({\n  selector: 'app-payment',\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], PaymentPage);\nexport { PaymentPage };","map":{"version":3,"mappings":"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","names":["Component","ElementRef","ViewChild","FormBuilder","AlertController","NavController","HttpClient","AvatarService","OverlayService","PaymentPage","constructor","prof","nav","http","alertCtrl","overlay","formBuilder","Stripe","ionViewDidEnter","skeletOns","setupStripe","getCards","subscribe","d","console","log","cards","forEach","element","selected","selectedCard","name","chooseCard","event","showLoader","updateCArd","number","type","id","hideLoader","appearance","theme","variables","colorPrimary","colorBackground","colorText","colorDanger","fontFamily","spacingUnit","borderRadius","elements","stripe","style","base","color","lineHeight","fontSmoothing","fontSize","invalid","iconColor","card","create","mount","addEventListener","displayError","document","getElementById","error","textContent","message","form","preventDefault","approve","createSource","then","result","errorElement","showAlert","source","createCard","last4","brand","removeEventListener","showToast","showPayMentAlert","title","subtitle","canLeave","alert","header","subHeader","buttons","text","role","handler","pop","backdropDismiss","present","ngOnInit","args","read","selector","template"],"sourceRoot":"","sources":["/Users/chineduetoh/Desktop/IONIC PROJECTS/Go_Rider/src/app/pages/payment/payment.page.ts"],"sourcesContent":["import { Component, ElementRef, OnInit, ViewChild } from '@angular/core';\nimport { FormGroup, FormBuilder, Validators, FormControl } from '@angular/forms';\nimport { AlertController, NavController } from '@ionic/angular';\nimport { HttpClient } from '@angular/common/http';\nimport { AvatarService } from 'src/app/services/avatar.service';\nimport { OverlayService } from 'src/app/services/overlay.service';\ndeclare var Stripe;\n\n@Component({\n  selector: 'app-payment',\n  templateUrl: './payment.page.html',\n  styleUrls: ['./payment.page.scss'],\n})\nexport class PaymentPage implements OnInit {\n  // stripe = Stripe(\"pk_test_0t85o0Llo0MbBfC9imSzznam\");\n\n  @ViewChild('paymentform',{read:ElementRef}) stripeButton : ElementRef;\n  cardpaymentForm: FormGroup;\n  public data: any;\n  info: any;\n  approve: boolean;\n  stripe = Stripe('pk_test_0t85o0Llo0MbBfC9imSzznam');\n  card: any;\n  cards: any[];\n  selectedCard: any;\n  selected: any;\n  skeletOns: {}[];\n  cash: any = 'cash'\n\n  constructor( public prof: AvatarService,\n    public nav: NavController, private http: HttpClient,\n    public alertCtrl: AlertController, private overlay: OverlayService, public formBuilder: FormBuilder) {}\n\n\n\n  ionViewDidEnter() {\n    this.skeletOns = [\n      {},{},{},{},{}\n    ]\n    this.setupStripe();\n   this.prof.getCards().subscribe((d)=>{\n       console.log(d);\n       this.cards = d\n\n       this.cards.forEach(element => {\n        console.log(element);\n         if (element.selected == true){\n          this.selected = element\n          this.selectedCard = element.name;\n          console.log(this.selectedCard);\n         }\n       });\n  })\n  }\n\n  async chooseCard(event){\n    console.log(event);\n    this.overlay.showLoader('Please wait..');\n    await this.prof.updateCArd(this.selected.name, this.selected.number, this.selected.type, this.selected.id, false)\n    await this.prof.updateCArd(event.name, event.number, event.type, event.id, true)\n    this.overlay.hideLoader();\n  }\n\n\n  async setupStripe() {\n    const appearance = {\n      theme: 'flat',\n    \n      variables: {\n        colorPrimary: '#0570de',\n        colorBackground: '#ffffff',\n        colorText: '#30313d',\n        colorDanger: '#df1b41',\n        fontFamily: 'Ideal Sans, system-ui, sans-serif',\n        spacingUnit: '2px',\n        borderRadius: '4px',\n        // See all possible variables below\n      }\n    };\n    let elements = this.stripe.elements();\n    var style = {\n      base: {\n        color: '#32325d',\n        lineHeight: '24px',\n        fontFamily: '\"Helvetica Neue\", Helvetica, sans-serif',\n        fontSmoothing: 'antialiased',\n        fontSize: '17px',\n        '::placeholder': {\n          color: '#aab7c4'\n        }\n      },\n      invalid: {\n        color: '#fa755a',\n        iconColor: '#3880ff'\n      }\n    };\n\n    this.card = elements.create('card', { style: style });\n    this.card.mount('#card-element');\n\n    this.card.addEventListener('change', event => {\n      var displayError = document.getElementById('card-errors');\n      if (event.error) {\n        displayError.textContent = event.error.message;\n      } else {\n        displayError.textContent = '';\n      }\n    });\n\n    var form = document.getElementById('payment-form');\n    form.addEventListener('submit', event => {\n      event.preventDefault();\n      console.log(event, this.card)\n      this.approve = true;\n\n      this.stripe.createSource(this.card).then(async result => {\n        this.approve = false;\n        if (result.error) {\n          var errorElement = document.getElementById('card-errors');\n          errorElement.textContent = result.error.message;\n          this.overlay.showAlert('Payment Error', result.error.message)\n        } else {\n          console.log(result.source.id);\n          await this.prof.updateCArd(this.selected.name, this.selected.number, this.selected.type, this.selected.id, false)\n          await this.prof.createCard(result.source.card.last4, result.source.card.last4, result.source.card.brand, result.source.id)\n          this.card.removeEventListener('change', event=>{})\n          form.removeEventListener('submit', event=>{})\n          await this.overlay.showToast('Successfully Added Card!')\n          this.setupStripe()\n        //  this.makePayment(result.id);\n        }\n      });\n    });\n  }\n  \n\n\n\n\n  async showPayMentAlert(title, subtitle, canLeave) {\n    const alert = await this.alertCtrl.create({\n      header: title,\n      subHeader: subtitle,\n      buttons: [{\n        text: 'Approve',\n        role: 'cancel',\n        handler: () => {\n          if (canLeave) {\n            this.nav.pop();\n          }\n        }\n      },],\n      backdropDismiss: false\n    });\n    alert.present();\n  }\n\n  ngOnInit() {\n\n  }\n\n}\n\n\n"]},"metadata":{},"sourceType":"module"}